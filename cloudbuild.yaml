steps:
  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'build',
      '--target', 'out_server',
      '-t', '${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${_TAG}',
      '.'
    ]
  - name: 'gcr.io/cloud-builders/docker'
    args: [
      'push',
      '${_REGION}-docker.pkg.dev/${PROJECT_ID}/${_REPOSITORY}/${_IMAGE}:${_TAG}'
    ]

substitutions:
  _REGION: 'australia-southeast1'
  _REPOSITORY: 'ctf'
  _IMAGE: 'services/noctf'
  _TAG: 'latest'